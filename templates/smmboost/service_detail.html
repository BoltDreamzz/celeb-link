{% extends 'smmboost/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}

    <h2>{{ service.name }}</h2>
    <p><strong>Category:</strong> {{ service.category }}</p>
    <p><strong>Rate:</strong> ${{ service.rate }} per 1000</p>
    <p><strong>Min:</strong> {{ service.min_quantity }} | Max: {{ service.max_quantity }}</p>

    <div x-data="{ loading: false, showToast: false, toastMessage: '', toastType: 'success' }"
        class="max-w-xl mx-auto mt-10 bg-white p-6 rounded-xl shadow-lg" x-init="
  window.addEventListener('order:feedback', event => {
    toastMessage = event.detail.message
    toastType = event.detail.type
    showToast = true
    setTimeout(() => showToast = false, 4000)
  })
">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">Place an Order</h2>

        <form method="post" @submit="loading = true" id="order-form">
            {% csrf_token %}

            <div class="mb-4">
                <label for="id_service" class="block mb-1 font-semibold text-gray-700">Select Service</label>
                {{ form.service }}
            </div>

            <div class="mb-4">
                <label for="id_link" class="block mb-1 font-semibold text-gray-700">Link</label>
                {{ form.link }}
            </div>

            <div class="mb-4">
                <label for="id_quantity" class="block mb-1 font-semibold text-gray-700">Quantity</label>
                {{ form.quantity }}
            </div>

            <button type="submit"
                class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 flex justify-center items-center gap-2 transition duration-200"
                :disabled="loading">
                <svg x-show="loading" class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z" />
                </svg>
                <span x-text="loading ? 'Processing...' : 'Submit Order'"></span>
            </button>
        </form>

        <!-- Toast Message -->
        <div x-show="showToast" x-transition :class="toastType === 'success' ? 'bg-green-500' : 'bg-red-500'"
            class="fixed bottom-5 right-5 text-white px-4 py-2 rounded shadow-md">
            <span x-text="toastMessage"></span>
        </div>
    </div>


</div>
<br>
<hr><br>
<h4 class="mt-5">Recent Orders</h4>
<ul>
    {% for order in orders %}
    <li>#{{ order.api_order_id }} - {{ order.status }} - {{ order.created_at|date:"M d, H:i" }}</li>
    {% empty %}
    <li>No recent orders for this service.</li>
    {% endfor %}
</ul>

{% endblock %}